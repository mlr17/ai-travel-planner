# 旅行规划应用-高德地图MCP集成说明

## 概述

本文档详细说明了旅行规划应用中与高德地图MCP服务的集成，以及在生成行程规划时如何让大模型调用这些服务获取POI数据和经纬度信息。

## 关键修改

1. **高德地图MCP服务功能文档**
   - 创建了`docs/高德地图MCP服务功能.md`，详细介绍了所有可用的高德地图MCP服务功能
   - 包括地理编码、周边搜索、关键词搜索、天气查询、路径规划等功能的用法和示例

2. **行程生成提示词模板**
   - 创建了`docs/行程生成提示词.md`，提供给Claude模型使用的详细提示词
   - 包含如何调用高德地图MCP服务的具体指令和示例代码
   - 强调每个地点必须包含准确的经纬度坐标

3. **API生成功能修改**
   - 更新了`src/utils/api.ts`中的`generateTripPlan`函数
   - 添加了提示词模板，可以根据用户提供的行程信息自动填充
   - 配置了最新的Claude-3.5-Sonnet模型
   - 优化了高德地图MCP服务的调用流程和错误处理

4. **测试功能**
   - 添加了`src/test/testTripGeneration.js`测试脚本
   - 用于验证生成的行程中各个地点是否包含准确的坐标信息
   - 提供详细的坐标覆盖率分析和测试报告

## 使用方法

### 1. 生成行程

当用户提交行程表单后，系统会：
1. 使用高德地图MCP服务的`geocode`功能获取目的地的精确坐标
2. 使用`aroundSearch`功能查找目的地周边的POI（景点、餐厅、酒店等）
3. 使用`weather`功能获取目的地的天气信息
4. 将所有信息填充到提示词模板中
5. 调用Claude-3.5-Sonnet模型生成行程规划
6. 模型会直接调用高德地图MCP服务获取更多详细的地理信息
7. 返回包含精确坐标的完整行程JSON数据

### 2. 运行测试

运行以下命令测试行程生成功能：

```bash
npm run test:trip-gen
```

测试脚本将生成一个样例行程并输出坐标覆盖率分析。理想情况下，应该达到90%以上的坐标覆盖率。

## 高德地图MCP服务列表

以下是主要的高德地图MCP服务及其功能：

| 服务名称 | 功能描述 | MCP调用方法 |
|---------|--------|-----------|
| 地理编码 | 将地址转换为经纬度坐标 | `mcp_amap_maps_maps_geo` |
| 逆地理编码 | 将经纬度转换为地址 | `mcp_amap_maps_maps_regeocode` |
| 关键词搜索 | 根据关键词查询POI | `mcp_amap_maps_maps_text_search` |
| 周边搜索 | 查询坐标周边的POI | `mcp_amap_maps_maps_around_search` |
| 天气查询 | 获取城市天气信息 | `mcp_amap_maps_maps_weather` |
| 驾车路线规划 | 计算两点间驾车路线 | `mcp_amap_maps_maps_direction_driving` |
| 步行路线规划 | 计算两点间步行路线 | `mcp_amap_maps_maps_direction_walking` |
| 公交路线规划 | 计算公共交通路线 | `mcp_amap_maps_maps_direction_transit_integrated` |

## 注意事项

1. 确保在行程生成前调用高德地图MCP服务获取目的地的基本信息
2. 提示词中应明确指导大模型如何使用MCP服务获取更多信息
3. 强调每个地点必须有经纬度坐标，以便在地图上准确标记
4. 根据用户的偏好和预算调整推荐的景点和活动
5. 优先使用周边搜索而非关键词搜索，以获取更准确的POI信息

## 未来改进方向

1. 缓存常用目的地的POI数据，减少API调用
2. 添加路径优化功能，根据各景点间的距离自动规划最佳路线
3. 增加更多本地化信息，如当地节假日、特色活动等
4. 提供更多交通选项和细节，包括具体的公交线路、票价等
5. 开发更多主题和风格的行程模板 